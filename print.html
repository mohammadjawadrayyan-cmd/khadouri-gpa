<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GPA Certificate â€” PTUK</title>
  <meta name="robots" content="noindex, nofollow" />
  <link rel="stylesheet" href="print.css" />
</head>
<body>
  <div class="page">
    <div class="actions noprint">
      <button id="btnPrint">Print</button>
      <a href="index.html">Back</a>
    </div>

    <header class="head">
      <div class="logo">
        <div class="badge"><span>PTUK</span></div>
        <div class="titles">
          <div class="t1">Palestine Technical University â€“ Kadoorie</div>
          <div class="t2">Ø¬Ø§Ù…Ø¹Ø© ÙÙ„Ø³Ø·ÙŠÙ† Ø§Ù„ØªÙ‚Ù†ÙŠØ© â€“ Ø®Ø¶ÙˆØ±ÙŠ</div>
        </div>
      </div>

      <div class="meta">
        <div class="meta__row"><span>Date</span><strong id="pDate">â€”</strong></div>
        <div class="meta__row"><span>Report</span><strong>GPA Certificate</strong></div>
      </div>
    </header>

    <section class="box">
      <h1 class="h1">GPA Certificate</h1>
      <p class="sub">This certificate shows your semester courses and GPA results (0â€“100 system).</p>
    </section>

    <section class="box">
      <h2 class="h2">Semester Courses</h2>
      <div class="table">
        <div class="thead">
          <div>Course</div>
          <div class="c">Credits</div>
          <div class="c">Grade</div>
          <div class="c">Result</div>
          <div class="c">Repeated</div>
        </div>
        <div id="pRows" class="tbody"></div>
      </div>
    </section>

    <section class="grid">
      <div class="box">
        <h2 class="h2">Semester GPA</h2>
        <div class="big" id="pSemAvg">â€”</div>
        <div class="mini" id="pSemMeta">â€”</div>
      </div>

      <div class="box">
        <h2 class="h2">Cumulative GPA</h2>
        <div class="big" id="pCumAvg">â€”</div>
        <div class="mini" id="pCumMeta">â€”</div>
        <div id="pCongrats" class="congrats" hidden>Congratulations! Your cumulative GPA improved ğŸ‰</div>
      </div>
    </section>

    <footer class="foot">
      <div class="copy">
        Â© Mohammad Jawad. All rights reserved.
        <div class="url">https://mohammadjawadrayyan-cmd.github.io/khadouri-gpa/</div>
      </div>
    </footer>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);

    function esc(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;");
    }

    function load(){
      const raw = localStorage.getItem("khadouri_gpa_data");
      if(!raw){
        $("#pRows").innerHTML = '<div class="empty">No data to print. Go back and calculate first.</div>';
        return;
      }

      let data;
      try{ data = JSON.parse(raw); }catch(e){
        $("#pRows").innerHTML = '<div class="empty">Invalid data. Please recalculate.</div>';
        return;
      }

      // Date in English
      try{
        const d = new Date(data.dateISO || Date.now());
        $("#pDate").textContent = d.toLocaleDateString("en-GB", { year:"numeric", month:"long", day:"2-digit" });
      }catch{
        $("#pDate").textContent = "â€”";
      }

      // Rows
      const rows = Array.isArray(data.courses) ? data.courses : [];
      if(rows.length === 0){
        $("#pRows").innerHTML = '<div class="empty">No courses.</div>';
      } else {
        $("#pRows").innerHTML = rows.map(r => {
          const rep = r.repeat ? "Yes" : "No";
          const status = r.status || (r.grade >= 60 ? "Pass" : "Fail");
          return `
            <div class="trow">
              <div>${esc(r.name)}</div>
              <div class="c">${esc(r.credits)}</div>
              <div class="c">${esc(r.grade)}</div>
              <div class="c ${status === "Fail" ? "bad": "good"}">${esc(status)}</div>
              <div class="c">${rep}</div>
            </div>
          `;
        }).join("");
      }

      // Semester
      if(data.semester){
        $("#pSemAvg").textContent = (data.semester.avg ?? "â€”");
        $("#pSemMeta").textContent = `Credits: ${data.semester.hours ?? "â€”"} â€¢ ${data.semester.label ?? ""}`;
      }

      // Cumulative
      if(data.cumulative && data.cumulative.ok){
        $("#pCumAvg").textContent = data.cumulative.avg ?? "â€”";
        $("#pCumMeta").textContent = `Total Hours: ${data.cumulative.hours ?? "â€”"} â€¢ ${data.cumulative.label ?? ""}`;
        if(data.cumulative.improved) $("#pCongrats").hidden = false;
      } else {
        $("#pCumAvg").textContent = "â€”";
        $("#pCumMeta").textContent = "Not calculated.";
      }
    }

    $("#btnPrint").addEventListener("click", () => window.print());
    load();
  </script>
</body>
</html>
