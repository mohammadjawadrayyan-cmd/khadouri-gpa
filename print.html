<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุดูุงุฏุฉ ุงููุนุฏู โ PTUK</title>
  <meta name="robots" content="noindex, nofollow" />
  <link rel="stylesheet" href="print.css" />
</head>
<body>
  <div class="page">
    <div class="actions noprint">
      <button id="btnPrint">ุทุจุงุนุฉ</button>
      <a href="index.html">ุฑุฌูุน</a>
    </div>

    <header class="head">
      <div class="logo">
        <div class="badge"><span>PTUK</span></div>
        <div class="titles">
          <div class="t1">Palestine Technical University โ Kadoorie</div>
          <div class="t2">ุฌุงูุนุฉ ููุณุทูู ุงูุชูููุฉ โ ุฎุถูุฑู</div>
        </div>
      </div>

      <div class="meta">
        <div class="meta__row"><span>ุงูุชุงุฑูุฎ</span><strong id="pDate">โ</strong></div>
        <div class="meta__row"><span>ุงูุชูุฑูุฑ</span><strong>ุดูุงุฏุฉ ุงููุนุฏู</strong></div>
      </div>
    </header>

    <section class="box">
      <h1 class="h1">ุดูุงุฏุฉ ุญุณุงุจ ุงููุนุฏู</h1>
      <p class="sub">ูุฐู ุงูุดูุงุฏุฉ ุชูุธูุฑ ููุงุฏ ุงููุตู ูุงููุนุฏู ุงููุตูู ูุงูุชุฑุงููู (ูุธุงู 100).</p>
    </section>

    <section class="box">
      <h2 class="h2">ุฌุฏูู ุงูููุงุฏ</h2>
      <div class="table">
        <div class="thead">
          <div>ุงุณู ุงููุงุฏุฉ</div>
          <div class="c">ุงูุณุงุนุงุช</div>
          <div class="c">ุงูุนูุงูุฉ</div>
          <div class="c">ุงููุชูุฌุฉ</div>
          <div class="c">ููุนุงุฏุฉุ</div>
        </div>
        <div id="pRows" class="tbody"></div>
      </div>
    </section>

    <section class="grid">
      <div class="box box--strong">
        <h2 class="h2">ุงููุนุฏู ุงููุตูู</h2>
        <div class="big" id="pSemAvg">โ</div>
        <div class="metaLine" id="pSemHours">โ</div>
        <div class="metaLine" id="pSemGrade">โ</div>
      </div>

      <div class="box box--strong">
        <h2 class="h2">ุงููุนุฏู ุงูุชุฑุงููู</h2>
        <div class="big" id="pCumAvg">โ</div>
        <div class="metaLine" id="pCumHours">โ</div>
        <div class="metaLine" id="pCumGrade">โ</div>
        <div id="pCongrats" class="congrats" hidden>๐ ูุจุฑูู! ููุฏ ุชุญุณู ูุนุฏูู ุงูุชุฑุงููู</div>
      </div>
    </section>

    <footer class="foot">
      <div class="copy">
        ยฉ Mohammad Jawad. All rights reserved.
        <div class="url">https://mohammadjawadrayyan-cmd.github.io/khadouri-gpa/</div>
      </div>
    </footer>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);

    function esc(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;");
    }

    function load(){
      const raw = localStorage.getItem("khadouri_gpa_data");
      if(!raw){
        $("#pRows").innerHTML = '<div class="empty">ูุง ุชูุฌุฏ ุจูุงูุงุช ููุทุจุงุนุฉ. ุงุฑุฌุน ูุงุญุณุจ ุฃููุงู.</div>';
        return;
      }

      let data;
      try{ data = JSON.parse(raw); }catch(e){
        $("#pRows").innerHTML = '<div class="empty">ุจูุงูุงุช ุบูุฑ ุตุงูุญุฉ. ุงุญุณุจ ูู ุฌุฏูุฏ.</div>';
        return;
      }

      // ุงูุชุงุฑูุฎ ููุท ุจุงูุฅูุฌููุฒู
      try{
        const d = new Date(data.dateISO || Date.now());
        $("#pDate").textContent = d.toLocaleDateString("en-GB", { year:"numeric", month:"long", day:"2-digit" });
      }catch{
        $("#pDate").textContent = "โ";
      }

      // ุงูุฌุฏูู (ุฃููุงู ุบุงููุฉ ุจุงูู CSS)
      const rows = Array.isArray(data.courses) ? data.courses : [];
      if(rows.length === 0){
        $("#pRows").innerHTML = '<div class="empty">ูุง ุชูุฌุฏ ููุงุฏ.</div>';
      } else {
        $("#pRows").innerHTML = rows.map(r => {
          const rep = r.repeat ? "ูุนู" : "ูุง";
          const status = r.status || (r.grade >= 60 ? "Pass" : "Fail");
          const arStatus = (status === "Fail") ? "ุฑุงุณุจ" : "ูุงุฌุญ";
          return `
            <div class="trow">
              <div>${esc(r.name)}</div>
              <div class="c">${esc(r.credits)}</div>
              <div class="c">${esc(r.grade)}</div>
              <div class="c ${arStatus === "ุฑุงุณุจ" ? "bad": "good"}">${arStatus}</div>
              <div class="c">${rep}</div>
            </div>
          `;
        }).join("");
      }

      // ุงููุตูู
      if(data.semester){
        $("#pSemAvg").textContent = (data.semester.avg ?? "โ");
        $("#pSemHours").textContent = `ุนุฏุฏ ุณุงุนุงุช ุงููุตู: ${data.semester.hours ?? "โ"}`;
        $("#pSemGrade").textContent = `ุงูุชูุฏูุฑ: ${data.semester.label ?? "โ"}`;
      }

      // ุงูุชุฑุงููู
      if(data.cumulative && data.cumulative.ok){
        $("#pCumAvg").textContent = data.cumulative.avg ?? "โ";
        $("#pCumHours").textContent = `ุฅุฌูุงูู ุงูุณุงุนุงุช: ${data.cumulative.hours ?? "โ"}`;
        $("#pCumGrade").textContent = `ุงูุชูุฏูุฑ: ${data.cumulative.label ?? "โ"}`;
        if(data.cumulative.improved) $("#pCongrats").hidden = false;
      } else {
        $("#pCumAvg").textContent = "โ";
        $("#pCumHours").textContent = "ุฅุฌูุงูู ุงูุณุงุนุงุช: โ";
        $("#pCumGrade").textContent = "ุงูุชูุฏูุฑ: โ";
      }
    }

    $("#btnPrint").addEventListener("click", () => window.print());
    load();
  </script>
</body>
</html>
